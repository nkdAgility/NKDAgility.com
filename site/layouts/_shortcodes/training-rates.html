{{ $trainingRates := .Site.Data.trainingRates.rates }}


<div class="training-rates">
  {{ if $trainingRates }}
    <!-- Group courses by sessions and level -->
    {{ $groupedRates := dict }}
    {{ range $trainingRates }}
      {{ $key := printf "%d-%s" .sessions .level }}
      {{ if index $groupedRates $key }}
        {{ $existingSlice := index $groupedRates $key }}
        {{ $newGroup := $existingSlice | append . }}
        {{ $groupedRates = merge $groupedRates (dict $key $newGroup) }}
      {{ else }}
        {{ $groupedRates = merge $groupedRates (dict $key (slice .)) }}
      {{ end }}
    {{ end }}


    <!-- Desktop Table View -->
    <div class="d-none d-lg-block">
      <div class="table-responsive">
        <table class="table table-striped table-hover">
          <thead class="table-dark">
            <tr>
              <th>Courses</th>
              <th>Sessions</th>
              <th>Level</th>
              <th>12</th>
              <th>16</th>
              <th>+Private</th>
              <th>Public</th>
            </tr>
          </thead>
          <tbody>
            {{ range $key, $group := $groupedRates }}
              {{ $first := index $group 0 }}
              <tr>
                <td>
                  {{ range $i, $course := $group }}
                    {{ if gt $i 0 }},{{ end }}
                    {{ $page := $.Site.GetPage $course.path }}
                    {{ if $page }}
                      <a href="{{ $page.Permalink }}" class="text-decoration-none" title="{{ $course.title }}">
                        <strong>{{ $course.code }}</strong>
                      </a>
                    {{ else }}
                      <strong title="{{ $course.title }}">{{ $course.code }}</strong>
                    {{ end }}
                  {{ end }}
                </td>
                <td class="text-center">{{ $first.sessions }}</td>
                <td>
                  <span class="badge bg-secondary">{{ title $first.level }}</span>
                </td>
                <td title="£{{ div (index $first.rates "12") 12 | lang.FormatNumber 0 }} per person">£{{ (index $first.rates "12") | lang.FormatNumber 0 }}</td>
                <td title="£{{ div (index $first.rates "16") 16 | lang.FormatNumber 0 }} per person">£{{ (index $first.rates "16") | lang.FormatNumber 0 }}</td>
                <td title="Per Additional Private">£{{ $first.rates.additional | lang.FormatNumber 0 }}</td>
                <td title="Public training rate">£{{ $first.rates.public | lang.FormatNumber 0 }}</td>
              </tr>
            {{ end }}
          </tbody>
        </table>
      </div>
    </div>

    <!-- Mobile Card View -->
    <div class="d-lg-none">
      <div class="row g-3">
        {{ range $key, $group := $groupedRates }}
          {{ $first := index $group 0 }}
          <div class="col-12 col-md-6">
            <div class="card h-100">
              <div class="card-header d-flex justify-content-between align-items-center">
                <div>
                  {{ range $i, $course := $group }}
                    {{ if gt $i 0 }},{{ end }}
                    {{ $page := $.Site.GetPage $course.path }}
                    {{ if $page }}
                      <a href="{{ $page.Permalink }}" class="text-decoration-none" title="{{ $course.title }}">
                        <strong class="fs-5">{{ $course.code }}</strong>
                      </a>
                    {{ else }}
                      <strong class="fs-5" title="{{ $course.title }}">{{ $course.code }}</strong>
                    {{ end }}
                  {{ end }}
                </div>
                <span class="badge bg-secondary">{{ title $first.level }}</span>
              </div>
              <div class="card-body">
                <h6 class="card-title text-muted mb-3">{{ $first.sessions }} Sessions</h6>
                <div class="row g-2">
                  <div class="col-6">
                    <div class="text-center p-2 training-rate-box rounded">
                      <small class="text-muted d-block">12 People</small>
                      <strong>£{{ (index $first.rates "12") | lang.FormatNumber 0 }}</strong>
                    </div>
                  </div>
                  <div class="col-6">
                    <div class="text-center p-2 training-rate-box rounded">
                      <small class="text-muted d-block">16 People</small>
                      <strong>£{{ (index $first.rates "16") | lang.FormatNumber 0 }}</strong>
                    </div>
                  </div>
                  <div class="col-6">
                    <div class="text-center p-2 training-rate-box rounded">
                      <small class="text-muted d-block">Per Additional Private</small>
                      <strong>£{{ $first.rates.additional | lang.FormatNumber 0 }}</strong>
                    </div>
                  </div>
                  <div class="col-6">
                    <div class="text-center p-2 bg-primary text-white rounded">
                      <small class="d-block">Public Rate</small>
                      <strong class="fs-6">£{{ $first.rates.public | lang.FormatNumber 0 }}</strong>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        {{ end }}
      </div>
    </div>
  {{ else }}
    <p>No training rates data available.</p>
  {{ end }}
</div>
