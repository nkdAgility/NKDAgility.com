{{/* Count rendered headings across the page with unique namespace */}}
{{ $scratchKey := printf "heading_count_%s" .Page.Params.ItemId }}
{{ $n := default 0 (.Page.Scratch.Get $scratchKey) }}
{{ $n = add $n 1 }}
{{ .Page.Scratch.Set $scratchKey $n }} 

{{/* Decide whether to inject before the 3rd heading */}}
{{ if eq $n 3 }}
    {{- $relatedMarketing := partial "functions/get-related-as-pages.html" (dict "Page" .Page "EntryKind" "marketing") }}
    {{- $relatedMarketing := first 1 $relatedMarketing }}
    
    {{- if $relatedMarketing }}
        {{- range $relatedMarketing }}
        <aside class="marketing-callout">
            <h4 class="marketing-callout__title">ðŸš€ {{ .Title }}</h4>
            {{- if .Description }}
            <p class="marketing-callout__description">{{ .Description }}</p>
            {{- end }}
            <a href="{{ .RelPermalink }}" class="marketing-callout__link">Learn more â†’</a>
        </aside>
        {{- else}}
        <aside class="marketing-callout">
            <h4 class="marketing-callout__title">ðŸš€ Technical Leadership in One Hour a Week</h4>
            <p class="marketing-callout__description">A practical guide to effective technical leadership, offering strategies and tips for making a meaningful impact with just one hour of focused effort each week.</p>
            <a href="/capabilities/technical-leadership-in-one-hour-a-week/#default" class="marketing-callout__link">Learn more â†’</a>
        </aside>
        {{- end }}
        {{- else }}
         <aside class="marketing-callout">
            <h4 class="marketing-callout__title">ðŸš€ Technical Leadership in One Hour a Week</h4>
            <p class="marketing-callout__description">A practical guide to effective technical leadership, offering strategies and tips for making a meaningful impact with just one hour of focused effort each week.</p>
            <a href="/capabilities/technical-leadership-in-one-hour-a-week/#default" class="marketing-callout__link">Learn more â†’</a>
        </aside>
    {{- end }}
    {{- else}}
    {{/*  <div>Not for heading {{$n}}</div>  */}}
{{ end }} 

{{/* Render the actual heading (preserve id/anchor) */}}
<h{{ .Level }} id="{{ .Anchor }}">{{ .Text | safeHTML }}</h{{ .Level }}>